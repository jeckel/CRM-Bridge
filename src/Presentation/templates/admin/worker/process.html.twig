{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Supervisor worker: {{ worker.group }}:{{ worker.name }}{% endblock %}

{% block page_actions %}
    <a href="{{ ea_url().setRoute('worker_list') }}" class="btn btn-default"><i class="fa-solid fa-arrow-left"></i> Liste</a>
    <a href="{{ ea_url().setRoute('worker_clear_logs', {name: worker.name, group: worker.group}) }}" class="btn btn-warning"><i class="fa-solid fa-trash-can"></i> Clear logs</a>
    {% if worker.state != 20 %}
        <a href="{{ ea_url().setRoute('worker_start', {name: worker.name, group: worker.group}) }}" class="btn btn-success"><i class="fa-solid fa-play"></i>&nbsp;Start</a>
    {% else %}
        <a href="{{ ea_url().setRoute('worker_stop', {name: worker.name, group: worker.group}) }}" class="btn btn-danger"><i class="fa-solid fa-stop"></i>&nbsp;Stop</a>
    {% endif %}

{% endblock %}

{% block main %}
    <dl class="row">
        <dt class="col-sm-3">Name</dt>
        <dd class="col-sm-9">{{ worker.name }}</dd>

        <dt class="col-sm-3">Group</dt>
        <dd class="col-sm-9">{{ worker.group }}</dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9">{{ worker.description }}</dd>

        <dt class="col-sm-3">State</dt>
        <dd class="col-sm-9">{{ worker.getState.name }}</dd>

        <dt class="col-sm-3">Pid</dt>
        <dd class="col-sm-9">{{ worker.pid }}</dd>

        <dt class="col-sm-3">Start</dt>
        <dd class="col-sm-9">{{ worker.start != 0 ? worker.start|date('d/m/Y H:i:s') : '<span class="badge badge-outline">Null</span>' }}</dd>

        <dt class="col-sm-3">Stop</dt>
        <dd class="col-sm-9">{{ worker.stop != 0 ? worker.stop|date('d/m/Y H:i:s') : '<span class="badge badge-outline">Null</span>' }}</dd>

        <dt class="col-sm-3">Logfile</dt>
        <dd class="col-sm-9">{{ worker.logfile }}</dd>

        <dt class="col-sm-3">Stdout Logfile</dt>
        <dd class="col-sm-9">{{ worker.stdout_logfile }}</dd>

        <dt class="col-sm-3">Stderr Logfile</dt>
        <dd class="col-sm-9">{{ worker.stderr_logfile }}</dd>

        <dt class="col-sm-3">Exit Status</dt>
        <dd class="col-sm-9">{{ worker.exitstatus }}</dd>

        <dt class="col-sm-3">Spawn Error</dt>
        <dd class="col-sm-9">{{ worker.spawnerr }}</dd>
    </dl>

    <div class="card mb-2">
        <div class="card-body">
            <h5 class="card-title">StdOut ({{ stdoutLog[1] }} lignes)</h5>
            <p class="card-text">{{ stdoutLog[0] | nl2br }}</p>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">StdErr ({{ stderrLog[1] }} lignes)</h5>
            <p class="card-text">{{ stderrLog[0] | nl2br }}</p>
        </div>
    </div>

{#    {{ dump(stdoutLog) }}#}
{#    {{ dump(stderrLog) }}#}
{% endblock %}
